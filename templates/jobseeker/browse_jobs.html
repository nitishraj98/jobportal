{% extends "base.html" %}
{% block title %}Browse Jobs - JobPortal{% endblock %}
{% block page_title %}Browse Jobs{% endblock %}

{% block content %}
<!-- Search Filters -->
<div class="data-card mb-4">
    <div class="p-4">
        <form method="GET" class="row g-3">
            <div class="col-md-5">
                <label class="form-label">Job Title / Keyword</label>
                <input type="text" name="q" class="form-control" placeholder="Search job title or keyword..." value="{{ q }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Location</label>
                <input type="text" name="location" class="form-control" placeholder="e.g. Mumbai, Remote" value="{{ loc }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Job Type</label>
                <select name="type" class="form-select">
                    <option value="">All Types</option>
                    {% for t in ['Full-time','Part-time','Contract','Remote','Internship'] %}
                    <option value="{{ t }}" {% if jtype==t %}selected{% endif %}>{{ t }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn-accent w-100" style="border-radius:10px; padding:11px; font-size:13px; font-weight:600; width:100%;">
                    <i class="fas fa-search me-1"></i> Search
                </button>
            </div>
        </form>
    </div>
</div>

<div class="d-flex align-items-center justify-content-between mb-3">
    <span style="font-size:13px; color:#94a3b8;">{{ jobs|length }} job(s) found</span>
    {% if q or loc or jtype %}
    <a href="{{ url_for('browse_jobs') }}" style="font-size:12px; color:#94a3b8; text-decoration:none;">
        <i class="fas fa-times me-1"></i> Clear filters
    </a>
    {% endif %}
</div>

{% if jobs %}
<div class="row g-3">
    {% for job in jobs %}
    <div class="col-md-6 col-xl-4">
        <div class="job-card h-100 d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <div style="font-size:11px; color:#94a3b8; margin-bottom:4px;">{{ job.employer_name }}</div>
                    <h3 style="font-size:15px; font-weight:700; margin:0;">{{ job.title }}</h3>
                    <div style="font-size:13px; color:#94a3b8; margin-top:2px;">{{ job.company }}</div>
                </div>
                <span class="job-type-badge type-{{ job.job_type|replace(' ','') }}">{{ job.job_type }}</span>
            </div>
            <div style="font-size:12px; color:#94a3b8; margin-bottom:10px; display:flex; flex-wrap:wrap; gap:12px;">
                <span><i class="fas fa-map-marker-alt me-1"></i> {{ job.location }}</span>
                {% if job.salary %}<span><i class="fas fa-money-bill-wave me-1"></i> {{ job.salary }}</span>{% endif %}
                <span><i class="fas fa-calendar me-1"></i> {{ job.created_at[:10] }}</span>
            </div>
            <p style="font-size:12px; color:#94a3b8; line-height:1.6; flex:1; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden;">
                {{ job.description }}
            </p>
            <div class="mt-3">
                {% if job.id in applied_ids %}
                <span class="badge-role badge-active w-100 text-center d-block" style="padding:9px; border-radius:8px; font-size:12px;">
                    <i class="fas fa-check me-1"></i> Application Submitted
                </span>
                {% else %}
                <button class="btn btn-outline-primary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#applyModal{{ job.id }}">
                    Apply Now <i class="fas fa-arrow-right ms-1" style="font-size:10px;"></i>
                </button>
                {% endif %}
            </div>
        </div>
    </div>

    {% if job.id not in applied_ids %}
    <div class="modal fade" id="applyModal{{ job.id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background:#1e293b; border:1px solid #334155; border-radius:16px;">
                <div class="modal-header" style="border-bottom:1px solid #334155;">
                    <div>
                        <h5 class="modal-title" style="font-weight:700; font-size:16px;">{{ job.title }}</h5>
                        <small style="color:#94a3b8;">{{ job.company }} &bull; {{ job.location }}</small>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" action="{{ url_for('apply_job', job_id=job.id) }}">
                    <div class="modal-body">
                        <label class="form-label">Cover Letter <span style="color:#475569;">(Optional)</span></label>
                        <textarea name="cover_letter" class="form-control" rows="5" placeholder="Introduce yourself and explain why you're excited about this role..."></textarea>
                    </div>
                    <div class="modal-footer" style="border-top:1px solid #334155; gap:8px;">
                        <button type="button" class="btn btn-sm" style="border:1px solid #334155; color:#94a3b8; border-radius:8px; padding:8px 16px;" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn-accent">Submit Application</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-search"></i>
    <p>No jobs found</p>
    <small style="color:#475569;">Try adjusting your search filters</small>
</div>
{% endif %}
{% endblock %}
