{% extends "base.html" %}
{% block title %}Dashboard - JobPortal{% endblock %}
{% block page_title %}Welcome back, {{ session.name }}!{% endblock %}
{% block header_actions %}
<a href="{{ url_for('browse_jobs') }}" class="btn-accent"><i class="fas fa-search me-1"></i>Find Jobs</a>
{% endblock %}

{% block content %}
<!-- Stats -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-4">
        <div class="stat-card">
            <div class="stat-icon" style="background:rgba(99,102,241,0.15);"><i class="fas fa-briefcase" style="color:#6366f1;"></i></div>
            <div class="stat-number">{{ available_jobs|length }}</div>
            <div class="stat-label">Jobs Available</div>
        </div>
    </div>
    <div class="col-6 col-md-4">
        <div class="stat-card">
            <div class="stat-icon" style="background:rgba(236,72,153,0.15);"><i class="fas fa-file-alt" style="color:#ec4899;"></i></div>
            <div class="stat-number">{{ applied_ids|length }}</div>
            <div class="stat-label">Applied Jobs</div>
        </div>
    </div>
    <div class="col-12 col-md-4">
        <div class="stat-card">
            <div class="stat-icon" style="background:rgba(245,158,11,0.15);"><i class="fas fa-user-check" style="color:#f59e0b;"></i></div>
            <div class="stat-number">
                {% if available_jobs|length > 0 %}
                {{ ((applied_ids|length / available_jobs|length) * 100)|int }}%
                {% else %}0%{% endif %}
            </div>
            <div class="stat-label">Activity Rate</div>
        </div>
    </div>
</div>

<!-- Recent Jobs -->
<div class="data-card-header mb-3 p-0" style="background:transparent; border:none;">
    <span class="data-card-title">Latest Job Openings</span>
    <a href="{{ url_for('browse_jobs') }}" class="btn btn-sm btn-outline-primary">Browse All</a>
</div>

{% if available_jobs %}
<div class="row g-3">
    {% for job in available_jobs %}
    <div class="col-md-6 col-lg-4">
        <div class="job-card h-100">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <div style="font-size:11px; color:#94a3b8; margin-bottom:4px;">{{ job.employer_name }}</div>
                    <h3 style="font-size:15px; font-weight:700; margin:0;">{{ job.title }}</h3>
                </div>
                <span class="job-type-badge type-{{ job.job_type|replace(' ','') }}">{{ job.job_type }}</span>
            </div>
            <div style="font-size:12px; color:#94a3b8; margin-bottom:8px;">
                <i class="fas fa-map-marker-alt me-1"></i> {{ job.location }}
                {% if job.salary %}
                &nbsp;&bull;&nbsp; <i class="fas fa-money-bill-wave me-1"></i> {{ job.salary }}
                {% endif %}
            </div>
            <p style="font-size:12px; color:#94a3b8; line-height:1.5; margin-bottom:16px; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;">
                {{ job.description }}
            </p>
            {% if job.id in applied_ids %}
            <span class="badge-role badge-active w-100 text-center d-block" style="padding:8px; border-radius:8px;">
                <i class="fas fa-check me-1"></i> Applied
            </span>
            {% else %}
            <button class="btn btn-outline-primary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#applyModal{{ job.id }}">
                Apply Now
            </button>
            {% endif %}
        </div>
    </div>

    <!-- Apply Modal -->
    {% if job.id not in applied_ids %}
    <div class="modal fade" id="applyModal{{ job.id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background:#1e293b; border:1px solid #334155; border-radius:16px;">
                <div class="modal-header" style="border-bottom:1px solid #334155;">
                    <h5 class="modal-title" style="font-weight:700;">Apply for {{ job.title }}</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" action="{{ url_for('apply_job', job_id=job.id) }}">
                    <div class="modal-body">
                        <div class="mb-3" style="background:rgba(99,102,241,0.08); border-radius:10px; padding:12px; font-size:12px; color:#a5b4fc;">
                            <strong>{{ job.company }}</strong> &bull; {{ job.location }} &bull; {{ job.job_type }}
                        </div>
                        <div>
                            <label class="form-label">Cover Letter (Optional)</label>
                            <textarea name="cover_letter" class="form-control" rows="5" placeholder="Tell the employer why you're a great fit..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer" style="border-top:1px solid #334155;">
                        <button type="button" class="btn btn-sm" style="border:1px solid #334155; color:#94a3b8; border-radius:8px;" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn-accent">Submit Application</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-search"></i>
    <p>No jobs available right now</p>
    <small style="color:#475569;">Check back soon for new opportunities</small>
</div>
{% endif %}
{% endblock %}
